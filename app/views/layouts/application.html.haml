%html
	%head
	%title Fancy Survey
	= stylesheet_link_tag :application
	= javascript_include_tag :application
	= javascript_include_tag :users
	= csrf_meta_tag
	:javascript

		function setSaveButton()
		{
			$('#profile').submit(function() 
			{  
				var valuesToSubmit = $(this).serialize();
				$.ajax(
				{
					url: $(this).attr('action'), 
					type: "post",
					data: valuesToSubmit,
					dataType: "JSON",
				});
				return false; 
			});
		}		

		$(document).on('ajax:success', function()
			{
				switch(localStorage['page'])
				{
					case "page1":
						$('#survey').html("#{escape_javascript(render :partial => 'page2')}");
						$('#survey-form').css('background-image', "image-url 'step_2_frame.png'");	
						setSaveButton();
						localStorage['page'] = "page2";
						break;
					case "page2":
						$('#survey').html("#{escape_javascript(render :partial => 'page3')}");	
						localStorage['page'] = "page3";
						break;
					default:
						break;
				}
				
			}
		);

		$(document).on('ajax:error', function()
			{
				alert("Проверьте, что все поля заполнены верно!");
			}
		);


		$(document).ready(function() 
		{

			switch(localStorage['page'])
			{
				case "page1":
					$('#survey').html("#{escape_javascript(render :partial => 'page1')}");	
					setSaveButton();
					break;

				case "page2":
					$('#survey').html("#{escape_javascript(render :partial => 'page2')}");	
					setSaveButton();
					break;

				case "page3":
					$('#survey').html("#{escape_javascript(render :partial => 'page3')}");	
					$.get('responses/gifbin', function(data) 
					{
						$('#picture').html("<img src=\""+data+"\">");
					});
					break;

				default:
					$('#survey').html("#{escape_javascript(render :partial => 'page1')}");	
					localStorage['page'] = "page1";
					setSaveButton();
					break;
			}
			
		});

	%body
		%table.header{ :width => "100%", :align => "center"}
			%td{ :width => "50%", :align => "center" }
				%img.logo{ :src => "assets/logo.png" }
			%td.navigation{ :width => "50%", :align => "center" }
				%table{ :height => "40px", :width => "100%"}
					%td.navigation#happy_testers 
						%a.navigation_link HAPPY TESTERS
					%td.navigation{ :width => "20px"}
					%td.navigation#status
						%a.navigation_link STATUS
					%td.navigation{ :width => "20px"}
					%td.navigation#todays_survey
						%a.navigation_link TODAY'S SURVEY
					%td.navigation{ :width => "20px"}
					%td.navigation#invite_friends
						%a.navigation_link INVITE FRIENDS
					%td.navigation

			%table.main{ :width => "100%"}
				%tr.empty{ :height => "50px" }
					%tr.content-top
					%td{ :width => "100%", :align => "center" }
						%table{ :width => "100%"}
							%td.empty{ :width => "10%"}
							%td.getting_prize{ :width => "35%"}
								%img{ :src => "assets/getting_points.png"}
							%td.timer{ :width => "35%", :valign => "top"}
								%table{:width => "100%", :height => "100%"}
									%tr{ :height => "25%"}
										%td.timer_caption
											Time remaining to complete your tasks
									%tr{ :height => "50%"}
										%td.timer_content
											%a.timer_seconds 
												342.1 
											%a.timer_units
												SECONDS
									%tr.empty{ :height => "25%"}				
							%td.empty{ :width => "10%"}	
				%tr.empty{ :height => "20px" }
				
				%tr.content-center{ :align => "center"}
					%td{ :width => "100%"}
						%table.survey#survey{ :width => "100%" }

					%tr.empty{ :height => "50px" }

			%div.footer{ :width => "100%" }
				&copy; Copyright Fancy Survey 2013.